<div id="form-wrapper" style="max-width: 600px; margin: auto; font-family: Arial, sans-serif; padding-top: 100px; padding-bottom: 0px; margin-bottom: 0px; overflow: auto; max-height: 100vh;">
  <h2 style="text-align: center; color: #228B22; font-weight: bold; font-size: 28px;">Äáº·t Lá»‹ch Trá»‹ Liá»‡u</h2>

  <label><b>1. Báº¡n biáº¿t Äá»¨C TÃ‚M qua dá»‹ch vá»¥ nÃ o?</b></label><br>
  <div style="font-size: 17px; line-height: 1.6;">
    <input type="radio" name="source" value="Tiktok" required> Tiktok<br>
    <input type="radio" name="source" value="Zalo" required> Zalo<br><br>
  </div>

  <hr style="border: 1px solid #ddd; margin: 20px 0;">

  <h3 style="text-align: center; color: #228B22; font-weight: bold; font-size: 25px; margin-bottom: 4px;">Nháº­p ThÃ´ng Tin</h3>
  <p style="text-align: center; font-style: italic; margin-top: 0;">LÆ°u Ã½</p>

  <label for="name"><b>2. Há» TÃªn:</b></label><br>
  <input type="text" id="name" name="name" placeholder="Nháº­p há» vÃ  tÃªn" required style="width: 100%; padding: 8px;"><br><br>

  <label for="phone"><b>3. Sá»‘ Äiá»‡n Thoáº¡i:</b></label><br>
  <input type="tel" id="phone" name="phone" pattern="[0-9]{10,11}" title="Chá»‰ Ä‘Æ°á»£c nháº­p sá»‘, tá»« 10-11 chá»¯ sá»‘" required style="width: 100%; padding: 8px;"><br><br>

  <label for="date"><b>4. Báº¡n Muá»‘n Äáº·t Lá»‹ch VÃ o NgÃ y NÃ o?</b></label><br>
  <input type="date" id="date" name="date" required style="width: 100%; padding: 8px;"><br><br>

  <label for="time"><b>5. Thá»i gian nÃ o?</b></label><br>
  <input type="time" id="time" name="time" required style="width: 100%; padding: 8px;"><br><br>

  <hr style="border: 1px solid #ddd; margin: 20px 0;">

  <h3 style="text-align: center; color: #228B22; font-weight: bold; font-size: 25px; margin-bottom: 4px;">Dá»‹ch Vá»¥ Liá»‡u TrÃ¬nh</h3>
  <p style="text-align: center; font-style: italic; margin-top: 0;">LÆ°u Ã½: Äƒn sÃ¡ng trÆ°á»›c khi Ä‘áº¿n cÆ¡ sá»Ÿ trá»‹ liá»‡u</p>

  <label><b>7. Báº¡n muá»‘n phá»¥c vá»¥ liá»‡u trÃ¬nh nÃ o?</b></label><br>
  <div style="font-size: 17px; line-height: 1.6;">
    <input type="checkbox" name="service" value="1 - Giáº£m Ä‘au Ä‘áº§u, viÃªm xoang, máº¥t ngá»§" required> 1 - Giáº£m Ä‘au Ä‘áº§u, viÃªm xoang, máº¥t ngá»§<br>
    <input type="checkbox" name="service" value="2 - Cá»• vai gÃ¡y"> 2 - Cá»• vai gÃ¡y<br>
    <input type="checkbox" name="service" value="3 - VÃ¹ng Ä‘au"> 3 - VÃ¹ng Ä‘au<br>
    <input type="checkbox" name="service" value="4 - Khai thÃ´ng kinh láº¡c toÃ n thÃ¢n"> 4 - Khai thÃ´ng kinh láº¡c toÃ n thÃ¢n<br>
    <input type="checkbox" name="service" value="5 - Giáº£i cÆ¡ thá»ƒ thao"> 5 - Giáº£i cÆ¡ thá»ƒ thao<br>
    <input type="checkbox" name="service" value="6 - Tá»•ng há»£p"> 6 - Tá»•ng há»£p<br>
    <input type="checkbox" name="service" value="7 - ÄÃ¡nh giÃ³ giÃ¡c hÆ¡i"> 7 - ÄÃ¡nh giÃ³ giÃ¡c hÆ¡i (dá»‹ch vá»¥ thÃªm)<br><br>
  </div>

  <label for="note"><b>8. Ghi chÃº vá» bá»‡nh cá»§a quÃ½ khÃ¡ch (náº¿u cÃ³):</b></label><br>
  <textarea id="note" name="note" required rows="4" style="width: 100%; padding: 8px;"></textarea><br><br>

  <div style="text-align: center;">
  <button onclick="submitForm()" style="padding: 16px 30px; font-size: 20px; font-weight: bold; background-color: green; color: white; border: none; border-radius: 8px; cursor: pointer;">
    Gá»­i
  </button>

</div>
</div> <!-- <- ÄÃ¢y lÃ  div bao toÃ n bá»™ form -->

<!-- âœ… MÃ n hÃ¬nh cáº£m Æ¡n -->
<div id="thank-you" style="display: none; max-width: 600px; margin: auto; padding: 100px 20px 50px; text-align: center; font-size: 20px; color: green;">
  <h2 style="color: #228B22; font-size: 28px;">ğŸ‰ Cáº£m Æ¡n báº¡n Ä‘Ã£ Ä‘áº·t lá»‹ch!</h2>
  <p style="font-size: 18px;">ChÃºng tÃ´i sáº½ liÃªn há»‡ láº¡i trong thá»i gian sá»›m nháº¥t.</p>
</div>

<!-- âœ… TÄƒng kÃ­ch cá»¡ chá»¯ nháº­p liá»‡u cho mobile -->
<style>
  input, textarea, button {
    font-size: 16px;
  }
</style>

<script>
  // Set ngÃ y tá»‘i thiá»ƒu lÃ  hÃ´m nay (UTC+7)
  const today = new Date();
  const timezoneOffset = 7 * 60; // UTC+7
  today.setMinutes(today.getMinutes() - today.getTimezoneOffset() + timezoneOffset);
  document.getElementById("date").min = today.toISOString().split("T")[0];

  function submitForm() {
    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;
    const note = document.getElementById("note").value.trim();

    const sourceSelected = document.querySelector('input[name="source"]:checked');
    const serviceSelected = document.querySelectorAll('input[name="service"]:checked');

    if (!sourceSelected) {
      alert("Vui lÃ²ng chá»n dá»‹ch vá»¥ báº¡n biáº¿t Ä‘áº¿n Äá»¨C TÃ‚M.");
      return;
    }

    if (serviceSelected.length === 0) {
      alert("Vui lÃ²ng chá»n Ã­t nháº¥t má»™t liá»‡u trÃ¬nh.");
      return;
    }

    if (!name || !phone || !date || !time || !note) {
      alert("Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ táº¥t cáº£ thÃ´ng tin báº¯t buá»™c.");
      return;
    }

    // âœ… Táº¡o dá»¯ liá»‡u Ä‘á»ƒ gá»­i
    const data = {
      name: name,
      phone: phone,
      date: date,
      time: time,
      service: Array.from(serviceSelected).map(s => s.value).join(", "),
      note: note
    };

    // âœ… Gá»­i dá»¯ liá»‡u báº±ng x-www-form-urlencoded (khÃ´ng bá»‹ lá»—i CORS)
const formData = new URLSearchParams();
formData.append("source", sourceSelected.value);    
formData.append("name", name);
formData.append("phone", phone);
formData.append("date", date);
formData.append("time", time);
formData.append("service", Array.from(serviceSelected).map(s => s.value).join(", "));
formData.append("note", note);

fetch("/api/submit", {
  method: "POST",
  headers: {
    "Content-Type": "application/x-www-form-urlencoded"
  },
  body: formData.toString()
})
.then(response => response.text())
.then(result => {
  // áº¨n form Ä‘áº·t lá»‹ch
  document.querySelector("#form-wrapper").style.display = "none";

  // Hiá»‡n mÃ n hÃ¬nh cáº£m Æ¡n
  const thankYou = document.getElementById("thank-you");
  thankYou.style.display = "block";
  thankYou.style.minHeight = "300px";
  thankYou.style.paddingBottom = "50px";

  // Gá»­i yÃªu cáº§u scroll lÃªn top cho trang cha
  setTimeout(() => {
    window.parent.postMessage("scroll-to-top", "*");
  }, 100);
})
.catch(error => {
  alert("ÄÃ£ xáº£y ra lá»—i khi gá»­i dá»¯ liá»‡u. Vui lÃ²ng thá»­ láº¡i.\n" + error);
});
  }
</script>
