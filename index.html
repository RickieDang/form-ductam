<div id="form-wrapper" style="max-width: 600px; margin: auto; font-family: Arial, sans-serif; padding-top: 100px; padding-bottom: 0px; margin-bottom: 0px; overflow: auto; max-height: 100vh;">
  <h2 style="text-align: center; color: #228B22; font-weight: bold; font-size: 28px;">Đặt Lịch Trị Liệu</h2>

  <label><b>1. Bạn biết ĐỨC TÂM qua dịch vụ nào?</b></label><br>
  <div style="font-size: 17px; line-height: 1.6;">
    <input type="radio" name="source" value="Tiktok" required> Tiktok<br>
    <input type="radio" name="source" value="Zalo" required> Zalo<br><br>
  </div>

  <hr style="border: 1px solid #ddd; margin: 20px 0;">

  <h3 style="text-align: center; color: #228B22; font-weight: bold; font-size: 25px; margin-bottom: 4px;">Nhập Thông Tin</h3>
  <p style="text-align: center; font-style: italic; margin-top: 0;">Lưu ý</p>

  <label for="name"><b>2. Họ Tên:</b></label><br>
  <input type="text" id="name" name="name" placeholder="Nhập họ và tên" required style="width: 100%; padding: 8px;"><br><br>

  <label for="phone"><b>3. Số Điện Thoại:</b></label><br>
  <input type="tel" id="phone" name="phone" pattern="[0-9]{10,11}" title="Chỉ được nhập số, từ 10-11 chữ số" required style="width: 100%; padding: 8px;"><br><br>

  <label for="date"><b>4. Bạn Muốn Đặt Lịch Vào Ngày Nào?</b></label><br>
  <input type="date" id="date" name="date" required style="width: 100%; padding: 8px;"><br><br>

  <label for="time"><b>5. Thời gian nào?</b></label><br>
  <input type="time" id="time" name="time" required style="width: 100%; padding: 8px;"><br><br>

  <hr style="border: 1px solid #ddd; margin: 20px 0;">

  <h3 style="text-align: center; color: #228B22; font-weight: bold; font-size: 25px; margin-bottom: 4px;">Dịch Vụ Liệu Trình</h3>
  <p style="text-align: center; font-style: italic; margin-top: 0;">Lưu ý: ăn sáng trước khi đến cơ sở trị liệu</p>

  <label><b>7. Bạn muốn phục vụ liệu trình nào?</b></label><br>
  <div style="font-size: 17px; line-height: 1.6;">
    <input type="checkbox" name="service" value="1 - Giảm đau đầu, viêm xoang, mất ngủ" required> 1 - Giảm đau đầu, viêm xoang, mất ngủ<br>
    <input type="checkbox" name="service" value="2 - Cổ vai gáy"> 2 - Cổ vai gáy<br>
    <input type="checkbox" name="service" value="3 - Vùng đau"> 3 - Vùng đau<br>
    <input type="checkbox" name="service" value="4 - Khai thông kinh lạc toàn thân"> 4 - Khai thông kinh lạc toàn thân<br>
    <input type="checkbox" name="service" value="5 - Giải cơ thể thao"> 5 - Giải cơ thể thao<br>
    <input type="checkbox" name="service" value="6 - Tổng hợp"> 6 - Tổng hợp<br>
    <input type="checkbox" name="service" value="7 - Đánh gió giác hơi"> 7 - Đánh gió giác hơi (dịch vụ thêm)<br><br>
  </div>

  <label for="note"><b>8. Ghi chú về bệnh của quý khách (nếu có):</b></label><br>
  <textarea id="note" name="note" required rows="4" style="width: 100%; padding: 8px;"></textarea><br><br>

  <div style="text-align: center;">
  <button onclick="submitForm()" style="padding: 16px 30px; font-size: 20px; font-weight: bold; background-color: green; color: white; border: none; border-radius: 8px; cursor: pointer;">
    Gửi
  </button>

</div>
</div> <!-- <- Đây là div bao toàn bộ form -->

<!-- ✅ Màn hình cảm ơn -->
<div id="thank-you" style="display: none; max-width: 600px; margin: auto; padding: 100px 20px 50px; text-align: center; font-size: 20px; color: green;">
  <h2 style="color: #228B22; font-size: 28px;">🎉 Cảm ơn bạn đã đặt lịch!</h2>
  <p style="font-size: 18px;">Chúng tôi sẽ liên hệ lại trong thời gian sớm nhất.</p>
</div>

<!-- ✅ Tăng kích cỡ chữ nhập liệu cho mobile -->
<style>
  input, textarea, button {
    font-size: 16px;
  }
</style>

<script>
  // Set ngày tối thiểu là hôm nay (UTC+7)
  const today = new Date();
  const timezoneOffset = 7 * 60; // UTC+7
  today.setMinutes(today.getMinutes() - today.getTimezoneOffset() + timezoneOffset);
  document.getElementById("date").min = today.toISOString().split("T")[0];

  function submitForm() {
    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;
    const note = document.getElementById("note").value.trim();

    const sourceSelected = document.querySelector('input[name="source"]:checked');
    const serviceSelected = document.querySelectorAll('input[name="service"]:checked');

    if (!sourceSelected) {
      alert("Vui lòng chọn dịch vụ bạn biết đến ĐỨC TÂM.");
      return;
    }

    if (serviceSelected.length === 0) {
      alert("Vui lòng chọn ít nhất một liệu trình.");
      return;
    }

    if (!name || !phone || !date || !time || !note) {
      alert("Vui lòng điền đầy đủ tất cả thông tin bắt buộc.");
      return;
    }

    // ✅ Tạo dữ liệu để gửi
    const data = {
      name: name,
      phone: phone,
      date: date,
      time: time,
      service: Array.from(serviceSelected).map(s => s.value).join(", "),
      note: note
    };

    // ✅ Gửi dữ liệu bằng x-www-form-urlencoded (không bị lỗi CORS)
const formData = new URLSearchParams();
formData.append("source", sourceSelected.value);    
formData.append("name", name);
formData.append("phone", phone);
formData.append("date", date);
formData.append("time", time);
formData.append("service", Array.from(serviceSelected).map(s => s.value).join(", "));
formData.append("note", note);

fetch("/api/submit", {
  method: "POST",
  headers: {
    "Content-Type": "application/x-www-form-urlencoded"
  },
  body: formData.toString()
})
.then(response => response.text())
.then(result => {
  // Ẩn form đặt lịch
  document.querySelector("#form-wrapper").style.display = "none";

  // Hiện màn hình cảm ơn
  const thankYou = document.getElementById("thank-you");
  thankYou.style.display = "block";
  thankYou.style.minHeight = "300px";
  thankYou.style.paddingBottom = "50px";

  // Gửi yêu cầu scroll lên top cho trang cha
  setTimeout(() => {
    window.parent.postMessage("scroll-to-top", "*");
  }, 100);
})
.catch(error => {
  alert("Đã xảy ra lỗi khi gửi dữ liệu. Vui lòng thử lại.\n" + error);
});
  }
</script>
